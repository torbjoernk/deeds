<div class="row form-group">
  <label class="col-md-3 form-control-label">
    <%= model_name_with_icon Source, :plural %>
    <span class="pull-right">
      <%= content_tag :a,
                      icon('refresh', class: 'fa-fw'),
                      id: 'btn-refresh-nested-fields',
                      class: 'btn btn-sm btn-outline-default',
                      title: t(:refresh_associations, scope: [:views, :modals]),
                      data: { toggle: 'tooltip' } %>
    </span>
  </label>
  <div class="col-md-9">
    <ul id="associate-sources" class="list-group list-group-flush">
      <% @collection.sources.each do |source| %>
        <li id="associated-source-<%= source.id %>" class="list-group-item form-control">
          <%= source.title %> (<%= source.source_type %>)
          <span class="btn-group btn-group-sm pull-right">
            <%= link_to_show_entity source %>
            <%= link_to collection_path(@collection.id, sub_action: :deassociate, source_id: source.id),
                        method: :patch,
                        remote: true,
                        id: "btn-deassoc-source-#{source.id}",
                        class: 'btn btn-sm btn-danger',
                        title: t(:delete_association, scope: [:views, :modals]),
                        data: { toggle: 'tooltip' } do %>
              <%= icon('minus', class: 'fa-fw') %>
            <% end %>
          </span>
        </li>
      <% end %>
      <li id="associate-source-add" class="list-group-item">
        <% if @free_sources.count > 0 %>
          <div class="form-group input-group">
            <%= text_field nil,
                           nil,
                           id: 'assoc-source-input',
                           class: 'form-control form-control-sm',
                           type: 'text',
                           list: 'free-sources',
                           placeholder: t(:search_for_unassociated, scope: [:views, :modals], what: Source.model_name.human(count: 2)) %>
            <%= content_tag :datalist, id: 'free-sources' do %>
              <% @free_sources.each do |source| %>
                <%= content_tag :option,
                                "#{source.title} (#{source.source_type})",
                                data: {'source-id': source.id } %>
              <% end %>
            <% end %>
            <div class="input-group-btn">
              <%= content_tag :a,
                              icon('search', class: 'fa-fw'),
                              id: 'btn-show-selected-source-details',
                              class: 'btn btn-sm btn-outline-info',
                              role: 'button' %>
              <%= content_tag :a,
                              icon('plus', class: 'fa-fw'),
                              id: 'btn-associate-selected-source',
                              class: 'btn btn-sm btn-primary',
                              role: 'button' %>
            </div>
          </div>
        <% else %>
          <%= t(:no_unassociated_found_html, scope: [:views, :modals], what: model_name_with_icon(Source, :plural)) %>
        <% end %>
      </li>
    </ul>
  </div>
</div>
